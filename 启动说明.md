# 工业工作流管理系统 - 启动说明

> 📅 更新日期：2025年10月22日  
> 💻 服务器部署指南

---

## 🚀 方式一：一键启动（推荐）

### 快速启动

1. **双击运行**
   ```
   一键启动.bat
   ```

2. **等待启动完成**
   - MongoDB 自动检查并启动
   - 后端服务自动启动（3001端口）
   - 前端服务自动启动（3000端口）
   - 浏览器自动打开系统页面

3. **开始使用** ✅

---

## 🔧 方式二：手动启动

### 步骤 1：启动 MongoDB

**检查 MongoDB 是否运行：**
```powershell
Get-Service -Name MongoDB
```

**如果没运行，启动它：**
```powershell
Start-Service -Name MongoDB
```

---

### 步骤 2：启动后端服务

**打开第一个 PowerShell 窗口**，运行：

```powershell
cd E:\workflow-web-main\workflow-web-main\backend
npm start
```

**看到以下信息说明启动成功：**
```
🚀 服务器启动成功！
📡 运行在: http://localhost:3001
```

**⚠️ 保持这个窗口打开！**

---

### 步骤 3：启动前端服务

**打开第二个 PowerShell 窗口**，运行：

```powershell
cd E:\workflow-web-main\workflow-web-main\workflow-web
npm start
```

浏览器会自动打开 `http://localhost:3000`

**⚠️ 保持这个窗口打开！**

---

## 🌐 访问地址

启动成功后，可以通过以下方式访问：

| 访问方式 | 前端地址 | 后端地址 |
|---------|---------|---------|
| **本机** | http://localhost:3000 | http://localhost:3001 |
| **局域网** | http://192.168.2.17:3000 | http://192.168.2.17:3001 |
| **Tailscale** | http://100.87.52.98:3000 | http://100.87.52.98:3001 |

**默认登录信息：**
- 用户名：`admin`
- 密码：`123456`

---

## 🛑 停止服务

1. **停止前端**：在前端窗口按 `Ctrl + C`
2. **停止后端**：在后端窗口按 `Ctrl + C`
3. **停止 MongoDB**（可选）：
   ```powershell
   Stop-Service -Name MongoDB
   ```

**或者直接关闭前端和后端的命令行窗口**

---

## ⚠️ 常见问题

### Q1: 双击一键启动.bat没反应？

**原因：** 可能被安全软件拦截

**解决：**
1. 右键点击 `一键启动.bat`
2. 选择"以管理员身份运行"
3. 或者将文件添加到安全软件白名单

---

### Q2: 提示"MongoDB 启动失败"

**解决：**

**方法1：手动启动 MongoDB**
```powershell
# 以管理员身份打开 PowerShell
Start-Service -Name MongoDB
```

**方法2：检查 MongoDB 是否已安装**
```powershell
Get-Service -Name MongoDB
```

如果提示找不到服务，说明 MongoDB 未安装或服务名不对。

---

### Q3: 端口被占用

**错误提示：**
```
Error: listen EADDRINUSE: address already in use :::3000
Error: listen EADDRINUSE: address already in use :::3001
```

**解决：**

**查找占用端口的进程：**
```powershell
netstat -ano | findstr :3000
netstat -ano | findstr :3001
```

**关闭进程：**
```powershell
# 根据上面查到的 PID（最后一列数字）
taskkill /PID 进程号 /F

# 例如：
taskkill /PID 12345 /F
```

**或者直接关闭前端和后端的命令行窗口**

---

### Q4: npm 命令无法运行

**解决：**

**方法1：使用 cmd 包装**
```powershell
cmd /c npm start
```

**方法2：检查 Node.js 是否安装**
```powershell
node -v
npm -v
```

如果提示命令不存在，需要安装 Node.js。

---

### Q5: 前端页面无法连接后端

**检查清单：**
1. ✅ 后端服务是否正常运行（查看后端窗口）
2. ✅ 访问 http://localhost:3001/api 测试后端
3. ✅ 检查防火墙是否拦截
4. ✅ 查看浏览器控制台（F12）的错误信息

---

### Q6: MongoDB 连接失败

**错误提示：**
```
MongooseServerSelectionError: connect ECONNREFUSED 127.0.0.1:27017
```

**解决：**
1. 检查 MongoDB 服务是否运行
2. 检查 MongoDB 端口是否是 27017
3. 检查 backend/.env 文件配置

---

### Q7: 浏览器没有自动打开

**解决：**
手动在浏览器输入：`http://localhost:3000`

---

## 📁 项目目录结构

```
E:\workflow-web-main\workflow-web-main\
├── 一键启动.bat           # 一键启动脚本 ⭐
├── 启动说明.md            # 本文档
├── 系统访问指南.md        # 用户访问指南
├── 苹果用户Tailscale下载指南.md
├── backend\               # 后端服务
│   ├── server.js         # 后端入口
│   ├── .env              # 环境配置（需要配置）
│   ├── start-server.bat  # 后端启动脚本
│   └── ...
└── workflow-web\         # 前端应用
    ├── src\              # 前端源码
    ├── package.json
    └── ...
```

---

## 🔐 环境配置

### 后端配置文件

**文件位置：** `backend/.env`

**必要配置：**
```env
# 数据库连接
MONGODB_URI=mongodb://localhost:27017/workflow_db

# JWT密钥（生产环境必须修改）
JWT_SECRET=your-secret-key-change-this-in-production

# 服务器端口
PORT=3001

# 运行环境
NODE_ENV=development

# 短信服务（阿里云）
SMS_PROVIDER=aliyun
ALIYUN_ACCESS_KEY_ID=你的AccessKey
ALIYUN_ACCESS_KEY_SECRET=你的AccessKeySecret
ALIYUN_SMS_SIGN_NAME=你的签名
ALIYUN_SMS_TEMPLATE_CODE=你的模板代码
```

**注意：** 如果没有 `.env` 文件，复制 `ENV_SAMPLE` 并重命名为 `.env`

---

## 💡 开发建议

### 日常使用

1. **早上开机后：** 双击运行 `一键启动.bat`
2. **开始工作：** 浏览器访问系统
3. **下班前：** 在前端和后端窗口按 `Ctrl + C` 停止服务（或直接关闭窗口）

### 开发模式

- **后端修改**：保存后需要重启（或安装 nodemon 自动重启）
- **前端修改**：保存后自动热更新
- **数据库操作**：使用 MongoDB Compass 图形化工具

### 性能优化

- ✅ 使用 SSD 硬盘
- ✅ 至少 8GB 内存
- ✅ 关闭不必要的后台程序
- ✅ 定期清理 node_modules（`npm install` 重装）

---

## 🔄 更新项目

### 获取最新代码

```bash
git pull origin master
```

### 更新依赖

**后端：**
```bash
cd backend
npm install
```

**前端：**
```bash
cd workflow-web
npm install
```

### 重启服务

1. 在前端和后端窗口按 `Ctrl + C` 停止服务
2. 运行 `一键启动.bat` 重新启动

---

## 📊 系统要求

### 服务器端

| 项目 | 要求 |
|-----|------|
| **操作系统** | Windows 10/11 |
| **Node.js** | v14.0 或更高版本 |
| **MongoDB** | v4.0 或更高版本 |
| **内存** | 最低 4GB，推荐 8GB+ |
| **硬盘** | 至少 10GB 可用空间 |

### 客户端（访问者）

| 项目 | 要求 |
|-----|------|
| **浏览器** | Chrome/Edge/Safari/Firefox 最新版 |
| **网络** | 局域网连接或 Tailscale VPN |
| **分辨率** | 最低 1280x720 |

---

## 🆘 紧急处理

### 系统完全无法启动

1. **重启电脑**
2. **检查 MongoDB 服务**
   ```powershell
   Get-Service -Name MongoDB
   Start-Service -Name MongoDB
   ```
3. **删除 node_modules 重新安装**
   ```bash
   cd backend
   rmdir /s node_modules
   npm install
   
   cd ../workflow-web
   rmdir /s node_modules
   npm install
   ```
4. **查看错误日志**
   - 后端窗口的错误信息
   - 前端窗口的错误信息
   - MongoDB 日志

### 数据库问题

**备份数据库：**
```bash
mongodump --db workflow_db --out backup/
```

**恢复数据库：**
```bash
mongorestore --db workflow_db backup/workflow_db/
```

---

## 📞 技术支持

### 自助排查

1. 查看本文档的"常见问题"部分
2. 查看《问题排查指南.md》
3. 检查后端/前端窗口的错误信息

### 联系管理员

如果无法解决，请提供：
- 操作系统版本
- Node.js 版本（`node -v`）
- 错误截图
- 后端/前端窗口的完整错误信息

---

## ✨ 快速参考

| 操作 | 命令 |
|-----|------|
| **一键启动** | 双击 `一键启动.bat` |
| **停止服务** | 在窗口按 `Ctrl + C` 或关闭窗口 |
| **检查MongoDB** | `Get-Service -Name MongoDB` |
| **启动MongoDB** | `Start-Service -Name MongoDB` |
| **停止MongoDB** | `Stop-Service -Name MongoDB` |
| **查看端口占用** | `netstat -ano \| findstr :3000` |
| **关闭进程** | `taskkill /PID 进程号 /F` |

---

**祝使用愉快！** 🎉

*如有问题请查看《问题排查指南.md》或联系管理员*
